from flask import Flask, render_template, request
import dns_records, whois_record, ipinfo


app = Flask(__name__)

@app.route("/", methods=['GET', 'POST'])
def dns_form():

    error = None

    my_dns = dns_records.DNS()
    my_whois = whois_record.WHO()
    a_ip = ipinfo.IP()

    dns_info = dict()
    whois_info = dict()
    ip_info = dict()

    # check for visitor ip
    try:
        my_ip = a_ip.my_ip_check()
    except:
        my_ip = 'unable to retrieve your current IP'

    if request.method == 'POST':
        text = request.form['text']

        # check for dns record info
        try:
            dns_info = my_dns.dns_info(text)
        except:
            dns_info['Error'] = 'DNS does not exist for {0}'.format(text)

        # Check for A record info
        try:
            a_record = my_dns.a_check(text)
            ip_info = a_ip.a_ip_check(a_record)
        except:
            ip_info['Error'] = "No A Record Info"
            print('No A Record')

        # check for whois info
        try:
            whois_info = my_whois.whois_check(text)
        except:
            whois_info['Error'] = "No Whois match for {0}".format(text)
            print("No Whois match for {0}".format(text))
        print(dns_info)
        return render_template('dns.html', dns_info=dns_info, ip_info=ip_info,
                                my_ip=my_ip, whois_info=whois_info)
    return render_template('dns.html', my_ip=my_ip, error=error)


if __name__ == "__main__":
    app.run(host='0.0.0.0')


